var map = L.map('map').setView([40.6993475,-73.972668], 11); //Initialize the map

// create a red polyline from an array of LatLng points
var latlngs = [
      [40.6869952519686,-74.0091274920654],[40.6829152639217,-74.0159674920654],[40.6795152738818,-74.0208674920654],[40.6729852930093,-74.0192474920654],[40.6623153242579,-74.0173174920654],[40.6416653847154,-74.0375974920654],[40.6359454014574,-74.0404274920654],[40.6300854186072,-74.0428274920654],[40.6220254421922,-74.0431774920654],[40.6131954680259,-74.0407674920654],[40.6090554801366,-74.0370774920654],[40.6050454918660,-74.0325274920654],[40.6039554950542,-74.0277374920654],[40.6039054952004,-74.0229574920654],[40.6022954999093,-74.0186874920654],[40.6014655023369,-74.0140674920654],[40.5994755081569,-74.0099074920654],[40.5965755166380,-74.0050574920654],[40.5894555374584,-74.0010874920654],[40.5852755496801,-74.0011474920654],[40.5825355576910,-74.0029174920654],[40.5829255565508,-74.0078274920654],[40.5815455605853,-74.0127374920654],[40.5786455690633,-74.0140674920654],[40.5750655795285,-74.0132974920654],[40.5735955838254,-74.0093874920654],[40.5731155852285,-74.0064874920654],[40.5722555877423,-74.0039374920654],[40.5699655944357,-74.0021274920654],[40.5759155770438,-73.9308374920654],[40.5811655616962,-73.9314574920654],[40.5830055563169,-73.9181174920654],[40.5848555509081,-73.9135374920654],[40.5874155434232,-73.9091274920654],[40.5873755435401,-73.8998474920654],[40.5788455684786,-73.8971874920654],[40.5764355755238,-73.8952074920654],[40.5798755654675,-73.8799174920654],[40.5846755514344,-73.8761974920654],[40.6050954917198,-73.8837974920654],[40.6200354480147,-73.8979174920654],[40.6229254395589,-73.8966274920654],[40.6339054074279,-73.8822074920654],[40.6482753653659,-73.8727574920654],[40.6542553478584,-73.8626174920654],[40.6562853419147,-73.8636574920654],[40.6579853369371,-73.8651274920654],[40.6602053304366,-73.8581974920654],[40.6636853202461,-73.8590974920654],[40.6640953190454,-73.8557874920654],[40.6719652959967,-73.8577974920654],[40.6715952970805,-73.8605174920654],[40.6795452737939,-73.8625574920654],[40.6795052739111,-73.8634174920654],[40.6827152645076,-73.8643074920654],[40.6824452652986,-73.8652774920654],[40.6822652658259,-73.8661874920654],[40.6855752561288,-73.8667174920654],[40.6914852388132,-73.8681674920654],[40.6960952253049,-73.8696874920654],[40.6976552207335,-73.8707974920654],[40.6972052220522,-73.8734674920654],[40.6967052235174,-73.8746074920654],[40.6956952264770,-73.8758074920654],[40.6946952294073,-73.8764174920654],[40.6941052311362,-73.8776674920654],[40.6930752341543,-73.8782274920654],[40.6925852355900,-73.8825674920654],[40.6912752394285,-73.8889974920654],[40.6930952340957,-73.8951774920654],[40.6971652221694,-73.9006574920654],[40.7038752025050,-73.9118974920654],[40.7096251856519,-73.9223274920654],[40.7151951693245,-73.9242574920654],[40.7187651588587,-73.9244674920654],[40.7197951558391,-73.9246974920654],[40.7261251372799,-73.9280574920654],[40.7276451328230,-73.9294474920654],[40.7282551310343,-73.9315774920654],[40.7290351287472,-73.9359174920654],[40.7299851259614,-73.9382574920654],[40.7312651222080,-73.9398174920654],[40.7337851148181,-73.9409874920654],[40.7349051115335,-73.9415774920654],[40.7356051094807,-73.9422274920654],[40.7377551031752,-73.9366474920654],[40.7469750761321,-73.9347874920654],[40.7490150701479,-73.9368674920654],[40.7495750685052,-73.9364074920654],[40.7503750661583,-73.9354674920654],[40.7510650641341,-73.9346774920654],[40.7516250624913,-73.9338074920654],[40.7519150616405,-73.9324374920654],[40.7519750614645,-73.9303974920654],[40.7520250613178,-73.9268274920654],[40.7524550600564,-73.9246074920654],[40.7516134955227,-73.9341259002685],[40.7508332419881,-73.9357566833496],[40.7509632848796,-73.9363574981689],[40.7512883909959,-73.9372158050537],[40.7523287198862,-73.9395332336425],[40.7527838586572,-73.9402198791503],[40.7531089558719,-73.9409923553466],[40.7533365229764,-73.9412069320678],[40.7534340514970,-73.9413785934448],[40.7534990704313,-73.941593170166,],[40.7536291081091,-73.9417648315429],[40.7536291081091,-73.9417648315429],[40.7535965987135,-73.9417648315429],[40.7536291081091,-73.9418935775756],[40.7537591455326,-73.9418506622314],[40.7537916548487,-73.9419794082641],[40.7538566734333,-73.9420652389526],[40.7539216919543,-73.9422369003295],[40.7541167471357,-73.9426660537719],[40.7542142745118,-73.9427947998046],[40.7542792926831,-73.9430522918701],[40.7543768198208,-73.9431810379028],[40.7548644533632,-73.9441680908203],[40.7550595057788,-73.9445543289184],[40.7553845918663,-73.9451551437377],[40.7557096763643,-73.9456272125244],[40.7566524124191,-73.9474296569824],[40.7576750447417,-73.9493974920654],[40.7608350354699,-73.9558474920654],[40.7621350316554,-73.9542574920654],[40.7711150053033,-73.9464674920654],[40.7738549972617,-73.9435174920654],[40.7762649901883,-73.9416974920654],[40.7821449729288,-73.9434474920654],[40.7834649690540,-73.9427774920654],[40.7854549632121,-73.9393074920654],[40.7882749549334,-73.9365874920654],[40.7895649511461,-73.9357574920654],[40.7908949472413,-73.9356974920654],[40.7924449426905,-73.9336074920654],[40.7940149380808,-73.9310074920654],[40.7950949349097,-73.9296974920654],[40.7968449297712,-73.9288874920654],[40.8018449150888,-73.9290474920654],[40.8033549106544,-73.9298074920654],[40.8039849088043,-73.9300774920654],[40.8046549068367,-73.9305274920654],[40.8076548980260,-73.9331174920654],[40.8081748964988,-73.9333974920654],[40.8087048949421,-73.9335474920654],[40.8097148919757,-73.9338974920654],[40.8107648888917,-73.9339874920654],[40.8197248625724,-73.9333674920654],[40.8335848218504,-73.9345474920654],[40.8348948180009,-73.9343874920654],[40.8364548134166,-73.9338774920654],[40.8383648078036,-73.9327974920654],[40.8446047894644,-73.9295974920654],[40.8481747789712,-73.9273274920654],[40.8515947689182,-73.9249474920654],[40.8592047465463,-73.9187574920654],[40.8629447355501,-73.9154674920654],[40.8663347255823,-73.9124274920654],[40.8674847222007,-73.9114674920654],[40.8686247188485,-73.9107874920654],[40.8697847154374,-73.9102874920654],[40.8710347117615,-73.9099974920654],[40.8720347088208,-73.9098774920654],[40.8728347064681,-73.9101974920654],[40.8735647043213,-73.9109474920654],[40.8741647025567,-73.9119574920654],[40.8750147000569,-73.9144474920654],[40.8756846980865,-73.9176474920654],[40.8759446973218,-73.9194874920654],[40.8764046959689,-73.9209074920654],[40.8770246941455,-73.9223274920654],[40.8776246923808,-73.9235074920654],[40.8780946909985,-73.9247274920654],[40.8783146903514,-73.9253674920654],[40.8783946901161,-73.9260874920654],[40.8782146906455,-73.9268074920654],[40.8779346914691,-73.9275274920654],[40.8774846927926,-73.9283374920654],[40.8769346944102,-73.9289774920654],[40.8733647049095,-73.9314874920654],[40.8699247150257,-73.9333874920654],[40.8691347173488,-73.9338274920654],[40.8632847345504,-73.9374774920654],[40.8547147597464,-73.9440774920654],[40.8510247705937,-73.9462874920654],[40.8479947795003,-73.9474674920654],[40.8385348073040,-73.9505574920654],[40.8325148249945,-73.9529174920654],[40.8205348601929,-73.9614474920654],[40.8161948729421,-73.9649274920654],[40.8116348863364,-73.9677774920654],[40.7715250041000,-73.9951274920654],[40.7700650083848,-73.9954474920654],[40.7637250269899,-74.0001174920654],[40.7627350298949,-74.0017274920654],[40.7518350618752,-74.0091574920654],[40.7489550703239,-74.0090274920654],[40.7451350815294,-74.0099474920654],[40.7449250821454,-74.0090474920654],[40.7391450990986,-74.0106074920654],[40.7268951350221,-74.0120974920654],[40.7218251498875,-74.0129774920654],[40.7217851500048,-74.0163874920654],[40.7205251536989,-74.0167674920654],[40.7198451556925,-74.0135174920654],[40.7192051575688,-74.0136374920654],[40.7194051569824,-74.0170374920654],[40.7107551823397,-74.0186274920654],[40.7058951965847,-74.0198674920654],[40.7016752089527,-74.0164174920654],[40.6942252307845,-74.0135874920654]
];

var polygon = L.polygon(latlngs, {color: '#f59121'}).addTo(map);

polygon.bindPopup("<img src='img/Via_Logo_White_Stacked.png' style='height:100px;' alt='Via' /><br /><h4>Current Service Area</h4>");

    map.createPane('labels');
    map.getPane('labels').style.zIndex = 650;
    map.getPane('labels').style.pointerEvents = 'none';
    var positron = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {
        attribution: '©OpenStreetMap, ©CartoDB'
    }).addTo(map);

    L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/light-v9/tiles/256/{z}/{x}/{y}', {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',
        maxZoom: 18,
        id: 'mapbox.light-v9_nolabels',
        accessToken: 'test'
    }).addTo(map);

    // Set hover colors
    function highlightFeature(e) {
      var layer = e.target;
      layer.setStyle({
      weight: 3,
      opacity: 1,
      fillColor: 'white'
      });
    }
    // A function to reset the colors when a neighborhood is not longer 'hovered'
    function resetHighlight(e) {
      var layer = e.target;
      layer.setStyle({
      weight: 3,
      opacity: 1,
      fillColor: '#faebd7'
      });
    }

    function onEachFeature(feature, layer) {

      var name = feature.properties.name;
      var container = $('<div />');

      if (name !== "Current Service Area"){
        container.on('click', '#vote', function(event) {
            event.preventDefault();
            window.open('https://docs.google.com/forms/d/e/1FAIpQLSe0Oq9RayU2HF0uJQgvMU96iAA9SEa46VUuIlO__4TYXPc2MQ/formResponse?usp=pp_url&ifq&entry.473915152='+name+'&entry.183451837='+$('#email').val()+'&submit=submit', '_blank');
        });
        container.html(`<h4>` + name + `</h3><p>Enter your email below:</p><input type="email" size="32" maxLength="32" required placeholder="email@example.com" id="email" style="color:black;"></input><form id="vote"><button type="submit" id="submit" class="btn btn-default btn-sm" style="margin-top: 12px;">Submit</button></form>`);
        layer.bindPopup(container[0]);
      } 
      else {
        container.html(`<img src="img/Via_Logo_White_Stacked.png" height="100"/> <h4>` + name + `</h4>`);
        layer.bindPopup(container[0]);
      }

        layer.on({
         mouseover: highlightFeature,
         mouseout: resetHighlight
         });
        

    }

    var baseStyle = {
      "fillColor":"#faebd7",
      "fillOpacity": "0.8",
      "color": "#1FB7E9"
    }

    var currentZone = {
      "fillColor":"#faebd7",
      "fillOpacity": "0.8",
      "color": "#f59121"
    }

    data = L.geoJSON(boroughs, {
      style: baseStyle,
      onEachFeature: onEachFeature,
      filter: boro
    }).addTo(map);

    data = L.geoJSON(districts, {
      style: baseStyle,
      onEachFeature: onEachFeature,
      filter: boro_cb
    }).addTo(map);

    data = L.geoJSON(airports, {
      style: currentZone,
      onEachFeature: onEachFeature
    }).addTo(map);

    function boro(feature){
      if (feature.properties.BoroName === "Staten Island") return true
    }

    function boro_cb(feature){
      if ((parseInt(feature.properties.communityDistrict) > 200 && parseInt(feature.properties.communityDistrict) < 300) || (parseInt(feature.properties.communityDistrict) > 400 && parseInt(feature.properties.communityDistrict) < 500))  return true
    }